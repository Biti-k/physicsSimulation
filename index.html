<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tiro Parab칩lico</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      overflow: auto;
      background-color: #02040a;
      background-image:
        radial-gradient(1px 1px at 20px 30px, white 90%, transparent),
        radial-gradient(1px 1px at 80px 120px, white 90%, transparent),
        radial-gradient(1px 1px at 140px 60px, white 90%, transparent),
        radial-gradient(1px 1px at 200px 180px, white 90%, transparent),
        radial-gradient(2px 2px at 50px 200px, #ccc 90%, transparent),
        radial-gradient(1px 1px at 170px 90px, #aaa 90%, transparent);
      background-size: 240px 240px;
      background-repeat: repeat;
      min-height: 300vh;
      padding-top: 100vh;
      position: relative;
      touch-action: none; /* Evita gestos de zoom y scroll manual mientras disparas */
      overscroll-behavior: none; /* Evita el rebote el치stico en m칩viles */
    }

    #bola {
      background-color: red;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: absolute;
      box-shadow: rgb(255, 39, 39) 0px 0px 15px;
    }

    h2 {
      position: fixed;
      top: 5px;
      left: 10px;
      margin: 0;
      font-size: 1.5rem;
      z-index: 100;
    }

    #controles {
      position: fixed;
      top: 50px;
      left: 10px;
      background-color: rgba(248, 248, 255, 0.15);
      border: 1px solid grey;
      padding: 10px;
      border-radius: 5px;
      max-width: 600px;
      width: calc(100vw - 20px);
      z-index: 100;
    }

    #controles label {
      display: block;
      margin-top: 8px;
      margin-bottom: 3px;
      font-size: 0.9rem;
    }

    #controles input[type="text"],
    #controles input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 4px;
      border: 1px solid #555;
      background: #333;
      color: white;
      font-size: 1rem;
    }

    #controles input[type="button"] {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background-color: #ff4444;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #controles input[type="button"]:active {
      background-color: #cc0000;
    }

    #info {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: rgba(248, 248, 255, 0.15);
      border: 1px solid grey;
      padding: 10px;
      border-radius: 5px;
      width: auto;
      max-width: 250px;
      font-size: 0.85rem;
      z-index: 100;
    }

    #info p {
      margin: 3px 0;
    }

    #info span {
      font-weight: bold;
    }

    /* Media queries para tablets */
    @media (max-width: 768px) {
      h2 {
        font-size: 1.3rem;
      }

      #controles {
        max-width: 280px;
      }

      #info {
        max-width: 200px;
        font-size: 0.75rem;
        padding: 8px;
      }
    }

    /* Media queries para m칩viles */
    @media (max-width: 480px) {
      h2 {
        font-size: 1.1rem;
        top: 3px;
        left: 5px;
      }

      #controles {
        top: 35px;
        left: 5px;
        right: 5px;
        width: calc(100vw - 10px);
        max-width: none;
        padding: 8px;
      }

      #controles label {
        font-size: 0.85rem;
        margin-top: 5px;
      }

      #controles input[type="text"],
      #controles input[type="number"] {
        padding: 10px;
        font-size: 0.95rem;
      }

      #controles input[type="button"] {
        padding: 14px;
        font-size: 1rem;
        margin-top: 8px;
      }

      #info {
        position: fixed;
        bottom: 10px;
        top: auto;
        right: 5px;
        max-width: calc(100% - 10px);
        font-size: 0.7rem;
        padding: 6px;
      }

      #info p {
        margin: 2px 0;
      }

      #bola {
        width: 30px;
        height: 30px;
      }
    }

    /* Media queries para pantallas muy peque침as */
    @media (max-width: 360px) {
      h2 {
        font-size: 1rem;
      }

      #controles label {
        font-size: 0.8rem;
      }

      #controles input[type="text"],
      #controles input[type="number"] {
        padding: 8px;
        font-size: 0.9rem;
      }

      #info {
        font-size: 0.65rem;
      }
    }
  </style>
</head>

<body>

  <h2>Tiro Parab칩lico</h2>
  <div id="bola"></div>

  <div id="controles">
    <label>Velocidad inicial (m/s)</label>
    <input type="number" id="velocidadInicial" placeholder="5" min="0" step="0.1">
    <label>츼ngulo (grados)</label>
    <input type="number" placeholder="20" id="angulo" min="0" max="90" step="1">
    <label>Gravedad (m/s)</label>
    <input type="number" placeholder="9.8" id="gravedad" min="0" step="0.1">
    <input type="button" value="Lanzar 游댠" id="dispararClick">
  </div>

  <div id="info">
    <p>Velocidad inicial: <span id="velocidadInicialInfo">0</span> m/s</p>
    <p>츼ngulo: <span id="anguloInfo">0</span> grados</p>
    <p>Gravedad: <span id="gravedadInfo">0</span> m/s</p>
    <p>Distancia: <span id="distanciaInfo">0</span> m</p>
    <p>Altura m치xima: <span id="alturaMaximaInfo">0</span> m</p>
    <p>Tiempo de vuelo: <span id="tiempoVueloInfo">0</span> s</p>
    <p>Escala metros/p칤xel: <span id="escalaInfo">0</span></p>
  </div>
  <!-- <button id="toggle-btn" onclick="document.getElementById('controles').classList.toggle('hidden')">丘뙖잺</button> -->
  <script>
    let bola = document.getElementById("bola");
    
    let escalaMetro = 40 * 2;

    let velH;
    let angulo;
    let g;
    let posX;
    let posY;
    let velY;
    let velX;

    let animId = null;
    let lastTime = null;

    let sueloAbsoluto; // Variable global

    const calcularSuelo = () => {
        // Calculamos el suelo basado en el tama침o total del documento
        sueloAbsoluto = document.documentElement.scrollHeight - 60;
    };

    const actualizarInfo = () => {
      document.getElementById("velocidadInicialInfo").textContent = (velH / escalaMetro).toFixed(2);
      document.getElementById("anguloInfo").textContent = (angulo * 180 / Math.PI).toFixed(2);
      document.getElementById("gravedadInfo").textContent = (g / escalaMetro).toFixed(2);
      document.getElementById("distanciaInfo").textContent = (posX / escalaMetro).toFixed(2);
      document.getElementById("escalaInfo").textContent = "1m = " + escalaMetro.toFixed(2) + "px";
    };

    const calcularTiempoVuelo = () => {
      const sueloAbsoluto = window.innerHeight + (document.body.offsetHeight - window.innerHeight) - 50;
      const y0 = posY;
      const v0y = velY;

      const a = 0.5 * g;
      const b = v0y;
      const c = y0 - sueloAbsoluto;

      const disc = b * b - 4 * a * c;
      if (disc < 0) return;

      const t1 = (-b + Math.sqrt(disc)) / (2 * a);
      const t2 = (-b - Math.sqrt(disc)) / (2 * a);
      const t = Math.max(t1, t2);

      document.getElementById("tiempoVueloInfo").textContent = t.toFixed(2);
    };

    const calcularAlturaMaxima = () => {
      const Vy = velH * Math.sin(angulo);
      const h = Vy * Vy / (2 * g);
      document.getElementById("alturaMaximaInfo").textContent = (h / escalaMetro).toFixed(2);
    };

    const valoresIniciales = () => {
      calcularSuelo();
      document.querySelector("meta[name=viewport]").setAttribute('content', 'width=device-width, user-scalable=no, initial-scale='+(1/window.devicePixelRatio)+'');

      velH = 5 * escalaMetro;
      angulo = 20 * Math.PI / 180;
      g = 9.8 * escalaMetro;
      posX = 0;
      posY = sueloAbsoluto - 10;
      velY = -Math.sin(angulo) * velH;
      velX = Math.cos(angulo) * velH;
      actualizarInfo();
      bola.style.left = posX + "px";
      bola.style.top = posY + "px";
      window.scrollTo({ left: 0, top: posY - window.innerHeight + 60, behavior: "auto" });
    };
    valoresIniciales();

    const mover = (timestamp) => {
      if (!lastTime) lastTime = timestamp;
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      velY += g * dt;
      posY += velY * dt;
      posX += velX * dt;

      const sueloAbsoluto = window.innerHeight + (document.body.offsetHeight - window.innerHeight) - 50;
      if (posY >= sueloAbsoluto) {
        posY = sueloAbsoluto;
        velX = 0;
        velY = 0;
        animId = null;
        return;
      }

      actualizarInfo();
      bola.style.left = posX + "px";
      bola.style.top = posY + "px";
      
      const scrollX = Math.max(0, posX - window.innerWidth / 2);
      const scrollY = Math.max(0, posY - window.innerHeight / 2);

      window.scrollTo({
          left: scrollX,
          top: scrollY,
          behavior: 'instant'
      });
      
      animId = requestAnimationFrame(mover);
    };

    const disparar = () => {
      valoresIniciales();
      lastTime = null;

      let gInput = parseFloat(document.getElementById("gravedad").value);
      let angInput = parseFloat(document.getElementById("angulo").value);
      let velInput = parseFloat(document.getElementById("velocidadInicial").value);

      if (!isNaN(gInput) && gInput >= 0) g = gInput * escalaMetro;
      if (!isNaN(angInput)) {
        angInput = Math.max(0, Math.min(90, angInput));
        angulo = angInput * Math.PI / 180;
      }
      if (!isNaN(velInput) && velInput >= 0) velH = velInput * escalaMetro;

      velY = -Math.sin(angulo) * velH;
      velX = Math.cos(angulo) * velH;

      calcularAlturaMaxima();
      calcularTiempoVuelo();

      if (animId) cancelAnimationFrame(animId);
      animId = requestAnimationFrame(mover);
    };

    document.getElementById("dispararClick").addEventListener("click", disparar);
  </script>

</body>

</html>